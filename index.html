<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Sapphire Beauty</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
*{box-sizing:border-box;margin:0;padding:0;}
body{font-family:'Segoe UI',Arial,sans-serif;background:#f5f0ff;color:#333;line-height:1.6;}
header{
    background:#800080;
    color:white;
    padding:15px 20px;
    display:flex;
    flex-direction:column;
    align-items:center;
    position:fixed;
    top:0;
    left:0;
    right:0;
    z-index:1000;
    box-shadow:0 4px 15px rgba(0,0,0,0.15);
    text-align:center;
}
.title-container{
    display:flex;
    align-items:center;
    justify-content:center;
    margin-bottom:12px;
    width:100%;
}
#logo{
    width:120px;
    height:120px;
    margin-right:20px;
    border-radius:50%;
    object-fit:cover;
}
header h1{
    margin:0;
    font-size:38px;
    font-weight:700;
    letter-spacing:1.5px;
}
nav{
    display:flex;
    flex-wrap:nowrap;
    overflow-x:auto;
    gap:25px;
    padding:10px 0;
    scrollbar-width:none;
    justify-content:center;
    width:100%;
}
nav::-webkit-scrollbar {display:none;}
nav a{
    color:white;
    text-decoration:none;
    font-weight:bold;
    cursor:pointer;
    transition:0.3s;
    font-size:16px;
    white-space:nowrap;
    padding:8px 12px;
}
nav a:hover{
    color:#e0b0ff;
    text-decoration:underline;
    background:rgba(255,255,255,0.1);
    border-radius:6px;
}
#userInfo{
    font-weight:bold;
    color:#fff;
    white-space:nowrap;
    padding:8px 12px;
}
#logoutBtn{
    background:#9932cc;
    color:white;
    padding:8px 18px;
    border-radius:8px;
    cursor:pointer;
    font-size:15px;
    border:none;
}
#logoutBtn:hover{background:#660099;}
#menuBtn{
    position:absolute;
    left:20px;
    top:50%;
    transform:translateY(-50%);
    font-size:34px;
    color:white;
    background:transparent;
    border:none;
    cursor:pointer;
    z-index:3000;
}
#menuBtn:hover{color:#e0b0ff;}
.hero{
    position:relative;
    margin-top:0;
}
.hero img{
    width:100%;
    height:700px;
    object-fit:cover;
    border-radius:15px;
    margin-bottom:15px;
    box-shadow:0 6px 20px rgba(0,0,0,0.1);
    display:block;
}
.hero-text{
    text-align:center;
    color:white;
    padding:20px;
    background:rgba(0,0,0,0.4);
    border-radius:15px;
    margin:0 20px 40px;
}
.hero-text h2{
    font-size:36px;
    margin-bottom:15px;
    text-shadow:2px 2px 8px black;
}
.hero-text p{
    font-size:20px;
    text-shadow:1px 1px 6px black;
}
.categories{display:flex;justify-content:center;gap:25px;flex-wrap:wrap;padding:40px 20px;}
.category-card{
    width:180px;height:180px;border-radius:15px;display:flex;align-items:flex-end;justify-content:center;
    color:white;font-weight:bold;font-size:18px;text-shadow:2px 2px 8px black;cursor:pointer;
    background-size:cover;background-position:center;transition:transform 0.4s;box-shadow:0 6px 20px rgba(0,0,0,0.2);
}
.category-card:hover{transform:scale(1.08);}
.category-card p{
    background:rgba(128,0,128,0.7);width:100%;padding:12px;text-align:center;border-radius:0 0 15px 15px;
}
.products{display:flex;flex-wrap:wrap;gap:25px;justify-content:center;padding:30px;}
.product{
    position:relative;background:white;padding:20px;width:250px;text-align:center;border-radius:15px;
    box-shadow:0 6px 20px rgba(0,0,0,0.1);overflow:hidden;transition:transform 0.4s;cursor:pointer;
}
.product:hover{transform:translateY(-10px);box-shadow:0 12px 30px rgba(0,0,0,0.15);}
.product img{width:100%;height:200px;object-fit:cover;border-radius:10px;}
.product h3{margin:15px 0 8px;font-size:20px;color:#333;}
.price-container{display:flex;justify-content:center;align-items:center;gap:10px;font-size:18px;margin:10px 0;}
.original-price{color:#888;text-decoration:line-through;}
.discounted-price{color:#d63384;font-weight:bold;font-size:20px;}
.product .stock{color:#d63384;font-size:14px;margin:5px 0;}
.product .rating{color:#ffb400;font-size:18px;margin:8px 0;display:none;}
.product-overlay{
    position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(128,0,128,0.85);
    display:flex;flex-direction:column;justify-content:center;align-items:center;opacity:0;transition:opacity 0.4s;border-radius:15px;
}
.product:hover .product-overlay{opacity:1;}
.product-overlay button{margin:8px;padding:12px 25px;font-size:16px;}
button{
    background:#9932cc;color:white;border:none;padding:12px 25px;margin:5px;cursor:pointer;
    border-radius:8px;font-size:16px;transition:0.3s;box-shadow:0 4px 10px rgba(0,0,0,0.1);
}
button:hover{background:#800080;transform:scale(1.05);}
footer{text-align:center;padding:25px;background:#800080;color:white;margin-top:50px;font-size:15px;}
.hidden{display:none;}
#loginSection,#signupSection,#cartSection,#adminSection{padding:30px;text-align:center;}
input[type=text],input[type=password],input[type=number],input[type=tel],textarea{
    padding:10px;width:300px;max-width:90%;font-size:16px;margin-bottom:15px;border-radius:8px;border:1px solid #ccc;
}
.error-message{color:#d63384;font-size:14px;margin-top:5px;}
#productDetailSection img{max-width:500px;border-radius:15px;margin:30px auto;display:block;box-shadow:0 10px 30px rgba(0,0,0,0.15);}
#productDetailSection h2{font-size:34px;color:#800080;margin:20px 0;}
#productDetailSection p{font-size:19px;margin:15px 0;}
#ratingStars button{background:none;border:none;font-size:24px;cursor:pointer;color:#ccc;}
#ratingStars button.selected, #ratingStars button:hover{color:#ffb400;}
#wishlistBtn{
    position:fixed;bottom:30px;right:30px;background:#800080;color:white;width:70px;height:70px;
    border-radius:50%;font-size:40px;box-shadow:0 6px 20px rgba(0,0,0,0.3);cursor:pointer;
    z-index:1000;border:none;transition:0.3s;display:flex;align-items:center;justify-content:center;
}
#wishlistBtn:hover{background:#9932cc;transform:scale(1.1);}
#wishlistCount{
    position:absolute;top:-8px;right:-8px;background:#ff3366;color:white;border-radius:50%;
    width:28px;height:28px;font-size:14px;line-height:28px;font-weight:bold;
}
#sidePanel{
    width:280px;background:#800080cc;backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);height:100%;position:fixed;top:0;left:-280px;transition:left 0.4s;
    padding-top:220px;box-shadow:4px 0 15px rgba(0,0,0,0.2);overflow-y:auto;z-index:999;
}
#sidePanel button{
    width:100%;text-align:left;padding:18px 20px;border:none;background:none;
    font-size:18px;font-weight:bold;cursor:pointer;color:white;border-bottom:1px solid rgba(255,255,255,0.2);
    transition:background 0.3s;
}
#sidePanel button:hover{background:rgba(255,255,255,0.15);color:#e0b0ff;}
#sidePanel ul{list-style:none;padding-left:30px;display:none;}
#sidePanel ul li{padding:12px 0;cursor:pointer;color:white;font-size:16px;font-weight:normal;}
#sidePanel ul li:hover{color:#e0b0ff;text-decoration:underline;}
#adminProductList{margin-top:30px;}
#adminProductList .product{width:300px;margin:10px auto;position:relative;}
#adminProductList .delete-btn{position:absolute;top:10px;right:10px;background:red;padding:5px 10px;font-size:12px;}
#adminOrderList .order{border:1px solid #ddd;padding:15px;margin:15px 0;border-radius:8px;background:#fff;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;}
#adminOrderList .order-details{flex:1;}
#adminOrderList .order-actions select{padding:8px;border-radius:6px;margin-right:10px;}
#adminOrderList .delete-order-btn{background:#d63384;padding:8px 12px;border-radius:6px;color:white;cursor:pointer;}
#analyticsDashboard{margin-top:40px;background:#fff;padding:20px;border-radius:10px;box-shadow:0 4px 15px rgba(0,0,0,0.1);}
#analyticsDashboard h3{color:#800080;}
.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;margin-top:20px;}
.stat-card{background:#f0e6ff;padding:20px;border-radius:10px;text-align:center;box-shadow:0 4px 10px rgba(0,0,0,0.1);}
.stat-card h4{font-size:18px;color:#800080;margin-bottom:10px;}
.stat-card p{font-size:32px;font-weight:bold;color:#333;}
#chartContainer{margin-top:30px;height:300px;}
#popupNotification{
    position:fixed;
    bottom:20px;
    right:20px;
    background:#800080;
    color:white;
    padding:15px 25px;
    border-radius:12px;
    box-shadow:0 8px 25px rgba(0,0,0,0.3);
    z-index:2000;
    opacity:0;
    transform:translateY(100px);
    transition:opacity 0.5s, transform 0.5s;
    font-size:16px;
    max-width:300px;
    text-align:center;
}
#popupNotification.show{
    opacity:1;
    transform:translateY(0);
}
main {
    padding-top: 220px;
    padding-left: 20px;
    padding-right: 20px;
}
#admin h2 {
    margin-top: 40px;
    margin-bottom: 20px;
}
@media(max-width:768px){
    .hero img{height:400px;}
    .hero-text h2{font-size:30px;}
    .hero-text p{font-size:18px;}
    #logo{
        width:100px;
        height:100px;
        margin-right:15px;
    }
    header h1{font-size:32px;}
    main { padding-top: 200px; padding-left: 15px; padding-right: 15px; }
}
@media(max-width:480px){
    .hero img{height:300px;}
    .hero-text h2{font-size:26px;}
    .hero-text p{font-size:16px;}
    #logo{
        width:80px;
        height:80px;
    }
    header h1{font-size:28px;}
    main { padding-top: 180px; padding-left: 10px; padding-right: 10px; }
}
</style>
</head>
<body>
<header>
    <button id="menuBtn" onclick="togglePanel()">‚ò∞</button>
    <div class="title-container">
        <img id="logo" src="images/logo.png" alt="Sapphire Beauty Logo">
        <h1>Sapphire Beauty</h1>
    </div>
    <nav>
        <a href="javascript:void(0)" onclick="showSection('home')">Home</a>
        <a href="javascript:void(0)" onclick="showSection('shop')">Shop</a>
        <a href="javascript:void(0)" onclick="showSection('wishlist')">Wishlist (<span id="wishlist-count">0</span>)</a>
        <a href="javascript:void(0)" onclick="showSection('cart')">Cart (<span id="cart-count">0</span>)</a>
        <a id="loginNav" href="javascript:void(0)" onclick="showSection('login')">Login</a>
        <a id="signupNav" href="javascript:void(0)" onclick="showSection('signup')">Signup</a>
        <a id="adminNav" class="hidden" href="javascript:void(0)" onclick="showSection('admin')">Admin</a>
        <span id="userInfo" class="hidden"></span>
        <button id="logoutBtn" class="hidden" onclick="logout()">Logout</button>
    </nav>
</header>

<button id="wishlistBtn" onclick="showSection('wishlist')">
    ‚ù§Ô∏è
    <span id="wishlistCount">0</span>
</button>

<div id="sidePanel">
    <button onclick="showSection('home'); togglePanel()">üè† Home</button>
    <button onclick="toggleBrand('eveline')">Eveline</button>
    <ul id="eveline"></ul>
    <button onclick="toggleBrand('neva')">Neva</button>
    <ul id="neva"></ul>
    <button onclick="toggleBrand('gabrini')">Gabrini</button>
    <ul id="gabrini"></ul>
</div>

<div id="popupNotification"></div>

<main>
<section id="home">
    <div class="hero">
        <img id="slideShow" src="images/Eveline.jpg" alt="Banner">
    </div>
    <div class="hero-text">
        <h2>Your One-Stop Cosmetic Store</h2>
        <p>Natural, high-quality products delivered to your door.</p>
    </div>
    <h2 style="text-align:center; color:#800080; margin-top:20px;">Shop by Category</h2>
    <div class="categories">
        <div class="category-card" onclick="showSection('shop'); filterCategory('skincare')" style="background-image:url('images/Skincare.jpg');"><p>Skincare</p></div>
        <div class="category-card" onclick="showSection('shop'); filterCategory('makeup')" style="background-image:url('images/Makeup.jpg');"><p>Makeup</p></div>
        <div class="category-card" onclick="showSection('shop'); filterCategory('haircare')" style="background-image:url('images/Haircare.jpg');"><p>Hair Care</p></div>
        <div class="category-card" onclick="showSection('shop'); filterCategory('fragrances')" style="background-image:url('images/Fragrances.jpg');"><p>Fragrances</p></div>
        <div class="category-card" onclick="showSection('shop'); filterCategory('tools')" style="background-image:url('images/Tools.jpg');"><p>Tools & Accessories</p></div>
        <div class="category-card" onclick="showSection('shop'); filterCategory('all')" style="background-color:#800080;"><p>All Products</p></div>
    </div>
</section>

<section id="signup" class="hidden">
    <div class="hero">
        <img src="images/Login.jpg" alt="Signup Banner">
        <div class="hero-content">
            <h2>Create Account</h2>
        </div>
    </div>
    <div id="signupSection">
        <input type="text" id="signupUsername" placeholder="Username" autocomplete="off"><br>
        <input type="password" id="signupPassword" placeholder="Password" autocomplete="new-password"><br>
        <div id="signupError" class="error-message"></div>
        <button onclick="signupUser()">Sign Up</button>
        <p>Already have an account? <a href="javascript:void(0)" onclick="showSection('login')">Login</a></p>
    </div>
</section>

<section id="login" class="hidden">
    <div class="hero">
        <img src="images/Login.jpg" alt="Login Banner">
        <div class="hero-content">
            <h2>Login</h2>
        </div>
    </div>
    <div id="loginSection">
        <input type="text" id="loginUsername" placeholder="Username" autocomplete="off"><br>
        <input type="password" id="loginPassword" placeholder="Password" autocomplete="current-password"><br>
        <div id="loginError" class="error-message"></div>
        <button onclick="loginUser()">Login</button>
        <p>Don't have an account? <a href="javascript:void(0)" onclick="showSection('signup')">Sign Up</a></p>
        <p style="margin-top:20px;"><a href="javascript:void(0)" onclick="showSection('admin')">Admin Login</a></p>
    </div>
</section>

<section id="admin" class="hidden">
    <h2>Admin Panel</h2>
    <div id="adminLoginForm">
        <input type="text" id="adminUsername" placeholder="Admin Username"><br>
        <input type="password" id="adminPassword" placeholder="Admin Password"><br>
        <button onclick="loginAdmin()">Login as Admin</button>
    </div>
    <div id="adminActions" class="hidden">
        <h3>Add New Product</h3>
        <input type="text" id="adminProdName" placeholder="Product Name"><br>
        <input type="text" id="adminProdCategory" placeholder="Category (skincare/makeup/etc)"><br>
        <input type="text" id="adminProdBrand" placeholder="Brand (eveline/neva/gabrini)"><br>
        <input type="number" id="adminProdPrice" placeholder="Original Price (PKR)"><br>
        <input type="number" id="adminProdDiscount" placeholder="Discount % (e.g. 20) - optional" min="0" max="99"><br>
        <input type="number" id="adminProdStock" placeholder="Stock Quantity" value="10"><br>
        <input type="file" id="adminProdImgFile" accept="image/*"><br>
        <button onclick="addProduct()">Add Product</button>

        <h3 style="margin-top:40px;">Apply Discount to Existing Product</h3>
        <select id="discountProductSelect"><option value="">-- Select Product --</option></select><br>
        <input type="number" id="discountPercentage" placeholder="Discount % (0-99)" min="0" max="99"><br>
        <button onclick="applyDiscount()">Apply Discount</button>
        <button onclick="removeDiscount()" style="background:#999;margin-left:10px;">Remove Discount</button>

        <h3 style="margin-top:40px;">Manage Products</h3>
        <div class="products" id="adminProductList"></div>

        <h3 style="margin-top:40px;">Customer Analytics Dashboard</h3>
        <div id="analyticsDashboard">
            <div class="stats-grid">
                <div class="stat-card">
                    <h4>Total Orders</h4>
                    <p id="totalOrders">0</p>
                </div>
                <div class="stat-card">
                    <h4>Total Revenue</h4>
                    <p id="totalRevenue">PKR 0</p>
                </div>
                <div class="stat-card">
                    <h4>Low Stock Items</h4>
                    <p id="lowStock">0</p>
                </div>
                <div class="stat-card">
                    <h4>Total Products</h4>
                    <p id="totalProducts">0</p>
                </div>
            </div>
            <div id="chartContainer">
                <canvas id="revenueChart"></canvas>
            </div>
        </div>

        <h3 style="margin-top:40px;">Order Management</h3>
        <div id="adminOrderList"></div>
    </div>
</section>

<section id="shop" class="hidden">
    <div class="hero">
        <img src="images/Shopping.jpg" alt="Shop Banner">
        <div class="hero-content">
            <h2>Shop</h2>
        </div>
    </div>
    <input type="text" id="searchBoxShop" placeholder="Search Products..." onkeyup="searchProducts()">
    <div class="products" id="productContainer"></div>
    <select id="categoryFilterShop" onchange="filterCategory(this.value)" style="margin:15px auto;display:block;">
        <option value="all">All Categories</option>
        <option value="skincare">Skincare</option>
        <option value="makeup">Makeup</option>
        <option value="haircare">Hair Care</option>
        <option value="fragrances">Fragrances</option>
        <option value="tools">Tools & Accessories</option>
    </select>
</section>

<section id="cart" class="hidden">
    <div class="hero">
        <img src="images/Cart.jpg" alt="Cart Banner">
        <div class="hero-content">
            <h2>Your Cart</h2>
        </div>
    </div>
    <div id="cartSection">
        <div id="cartItems"></div>
        <div class="cart-total" id="cartTotal"></div>
        <div id="checkoutFormSection" class="hidden">
            <h3 style="color:#800080;">Delivery Details (Cash on Delivery)</h3>
            <input type="text" id="buyerName" placeholder="Full Name" required><br>
            <input type="tel" id="buyerPhone" placeholder="Phone Number (e.g. 03xx-xxxxxxx)" required><br>
            <input type="text" id="buyerCity" placeholder="City" required><br>
            <textarea id="buyerAddress" placeholder="Complete Delivery Address (House no, Street, Area)" rows="4" required></textarea><br>
            <input type="text" id="buyerLandmark" placeholder="Nearby Landmark (optional)"><br>
            <button onclick="confirmOrder()">Confirm Order</button>
            <button onclick="cancelCheckout()">Cancel</button>
        </div>
        <button id="checkoutBtn" onclick="startCheckout()">Checkout (COD)</button>
        <button onclick="clearCart()">Clear Cart</button>
    </div>
</section>

<section id="productDetail" class="hidden">
    <div id="productDetailSection">
        <button onclick="showSection('shop')" style="position:absolute;top:20px;left:20px;background:#800080;color:white;padding:12px 25px;border-radius:8px;font-size:16px;">‚Üê Back to Shop</button>
        <img id="detailImg" src="" alt="Product Image">
        <h2 id="detailName"></h2>
        <p><strong>Brand:</strong> <span id="detailBrand"></span></p>
        <p><strong>Category:</strong> <span id="detailCategory"></span></p>
        <div id="detailPriceContainer"></div>
        <p><strong>Stock:</strong> <span id="detailStock"></span></p>
        <div class="rating" id="detailRating"></div>
        <div id="ratingStars">
            Rate this product:
            <button onclick="rateProduct(1)">‚òÖ</button>
            <button onclick="rateProduct(2)">‚òÖ</button>
            <button onclick="rateProduct(3)">‚òÖ</button>
            <button onclick="rateProduct(4)">‚òÖ</button>
            <button onclick="rateProduct(5)">‚òÖ</button>
        </div>
        <button id="detailAddToCart">Add to Cart</button>
        <button onclick="addToWishlist(currentProduct)" style="background:#ff3366;">‚ù§Ô∏è Add to Wishlist</button>
    </div>
</section>

<section id="wishlist" class="hidden">
    <div class="hero">
        <img src="images/Cart.jpg" alt="Wishlist Banner">
        <div class="hero-content">
            <h2>Your Wishlist</h2>
        </div>
    </div>
    <div class="products" id="wishlistItems"></div>
    <div style="text-align:center;margin-top:30px;">
        <button onclick="showSection('home')">Continue Shopping</button>
    </div>
</section>
</main>

<footer>
    <p>¬© 2026 Sapphire Beauty</p>
</footer>

<script>
// ==================== DATA & STATE ====================
const ADMIN_CREDENTIALS = { username: "admin", password: "admin123" };
let currentUser = null;
let isAdmin = false;
let products = JSON.parse(localStorage.getItem('sapphire_products') || '[]');
let wishlist = [];
let orders = JSON.parse(localStorage.getItem('sapphire_orders') || '[]');
let currentCategory = 'all';
let currentProduct = null;
let revenueChart = null;

// Fake purchase notifications
const pakistaniUsernames = ["AliKhan92", "Fatima_Pk", "UsmanRwp", "Ayesha_Lhr", "Bilal_Khi", "Sana_Isb", "Hamza_Pesh", "Zainab_Fsd", "Omar_Guj", "Noor_Skt", "Ahmed_Multan", "Maria_Rwp"];
const brands = ["Gabrini", "Neva", "Eveline"];
const productsList = {
    "Gabrini": ["Matte Lipstick", "BB Cream", "Nail Polish", "Foundation"],
    "Neva": ["Moisturizer", "Face Serum", "Eye Cream", "Cleanser"],
    "Eveline": ["Mascara", "Eyeliner", "Concealer", "Blush"]
};
function getRandomPurchaseMessage() {
    const username = pakistaniUsernames[Math.floor(Math.random() * pakistaniUsernames.length)];
    const brand = brands[Math.floor(Math.random() * brands.length)];
    const product = productsList[brand][Math.floor(Math.random() * productsList[brand].length)];
    return `${username} just bought ${brand} ${product}! üéâ`;
}
function showPopup() {
    const popup = document.getElementById('popupNotification');
    popup.textContent = getRandomPurchaseMessage();
    popup.classList.add('show');
    setTimeout(() => {
        popup.classList.remove('show');
    }, 5000);
}
setInterval(showPopup, 240000);
window.addEventListener('load', function() {
    init();
    setTimeout(showPopup, 5000);
});

// ==================== USER MANAGEMENT ====================
function getUsers() {
    const usersData = localStorage.getItem('sapphire_users');
    return usersData ? JSON.parse(usersData) : [];
}
function saveUsers(users) {
    localStorage.setItem('sapphire_users', JSON.stringify(users));
}
function userExists(username) {
    const users = getUsers();
    return users.some(u => u.username.toLowerCase() === username.toLowerCase());
}

// ==================== AUTH FUNCTIONS ====================
function signupUser() {
    const username = document.getElementById('signupUsername').value.trim();
    const password = document.getElementById('signupPassword').value.trim();
    const errorEl = document.getElementById('signupError');
    errorEl.textContent = '';
    if (!username || !password) {
        errorEl.textContent = 'Please fill in all fields';
        return;
    }
    if (username.length < 3) {
        errorEl.textContent = 'Username must be at least 3 characters';
        return;
    }
    if (password.length < 5) {
        errorEl.textContent = 'Password must be at least 5 characters';
        return;
    }
    if (userExists(username)) {
        errorEl.textContent = 'Username already taken';
        return;
    }
    const users = getUsers();
    users.push({ username, password });
    saveUsers(users);
    alert('Account created successfully! You can now login.');
    showSection('login');
    document.getElementById('signupUsername').value = '';
    document.getElementById('signupPassword').value = '';
}
function loginUser() {
    const username = document.getElementById('loginUsername').value.trim();
    const password = document.getElementById('loginPassword').value.trim();
    const errorEl = document.getElementById('loginError');
    errorEl.textContent = '';
    if (!username || !password) {
        errorEl.textContent = 'Please fill in all fields';
        return;
    }
    const users = getUsers();
    const user = users.find(u => u.username.toLowerCase() === username.toLowerCase() && u.password === password);
    if (!user) {
        errorEl.textContent = 'Invalid credentials';
        return;
    }
    currentUser = user.username;
    isAdmin = false;
    localStorage.setItem('currentUser', currentUser);
    localStorage.setItem('isAdmin', 'false');
    wishlist = JSON.parse(localStorage.getItem('wishlist_' + currentUser) || '[]');
    alert(`Welcome back, ${currentUser}!`);
    updateHeader();
    showSection('home');
}
function loginAdmin() {
    const username = document.getElementById('adminUsername').value.trim();
    const password = document.getElementById('adminPassword').value.trim();
    if (username === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password) {
        currentUser = "admin";
        isAdmin = true;
        localStorage.setItem('currentUser', currentUser);
        localStorage.setItem('isAdmin', 'true');
        alert('Admin login successful!');
        document.getElementById('adminLoginForm').classList.add('hidden');
        document.getElementById('adminActions').classList.remove('hidden');
        populateDiscountSelect();
        renderAdminProductList();
        renderAdminOrderList();
        renderAnalyticsDashboard();
        updateHeader();
        showSection('admin');
    } else {
        alert('Invalid admin credentials');
    }
}
function logout() {
    currentUser = null;
    isAdmin = false;
    localStorage.removeItem('currentUser');
    localStorage.removeItem('isAdmin');
    updateHeader();
    showSection('home');
}

// ==================== UI & STATE ====================
function updateHeader() {
    const userInfo = document.getElementById('userInfo');
    const loginNav = document.getElementById('loginNav');
    const signupNav = document.getElementById('signupNav');
    const adminNav = document.getElementById('adminNav');
    const logoutBtn = document.getElementById('logoutBtn');
    if (currentUser) {
        userInfo.innerText = `Hello, ${currentUser}`;
        userInfo.classList.remove('hidden');
        logoutBtn.classList.remove('hidden');
        loginNav.classList.add('hidden');
        signupNav.classList.add('hidden');
        if (isAdmin) {
            adminNav.classList.remove('hidden');
        } else {
            adminNav.classList.add('hidden');
        }
    } else {
        userInfo.classList.add('hidden');
        logoutBtn.classList.add('hidden');
        loginNav.classList.remove('hidden');
        signupNav.classList.remove('hidden');
        adminNav.classList.add('hidden');
    }
}
function showSection(id) {
    document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
    document.getElementById(id).classList.remove('hidden');
    if (id === 'shop') renderProducts(currentCategory);
    if (id === 'cart') renderCart();
    if (id === 'wishlist') renderWishlist();
    if (id === 'admin') {
        if (isAdmin) {
            document.getElementById('adminLoginForm').classList.add('hidden');
            document.getElementById('adminActions').classList.remove('hidden');
            populateDiscountSelect();
            renderAdminProductList();
            renderAdminOrderList();
            renderAnalyticsDashboard();
        } else {
            document.getElementById('adminLoginForm').classList.remove('hidden');
            document.getElementById('adminActions').classList.add('hidden');
        }
    }
    updateHeader();
}

// ==================== SIDE PANEL ====================
function togglePanel() {
    const panel = document.getElementById('sidePanel');
    panel.style.left = panel.style.left === '0px' ? '-280px' : '0px';
}
function toggleBrand(brand) {
    const ul = document.getElementById(brand);
    ul.style.display = ul.style.display === 'block' ? 'none' : 'block';
}

// ==================== DISCOUNT FUNCTIONS ====================
function populateDiscountSelect() {
    const select = document.getElementById('discountProductSelect');
    select.innerHTML = '<option value="">-- Select Product --</option>';
    products.forEach((p, i) => {
        const opt = document.createElement('option');
        opt.value = i;
        opt.textContent = p.name;
        select.appendChild(opt);
    });
}
function applyDiscount() {
    if (!isAdmin) return;
    const index = document.getElementById('discountProductSelect').value;
    const perc = parseFloat(document.getElementById('discountPercentage').value);
    if (index === "" || isNaN(perc) || perc < 0 || perc >= 100) {
        alert("Select a product and valid discount (0-99%)");
        return;
    }
    const p = products[index];
    p.discount = perc;
    p.discountedPrice = Math.round(p.originalPrice * (1 - perc / 100));
    localStorage.setItem('sapphire_products', JSON.stringify(products));
    renderProducts(currentCategory);
    renderAdminProductList();
    if (currentProduct && currentProduct.name === p.name) showProductDetail(p);
    alert("Discount applied!");
}
function removeDiscount() {
    if (!isAdmin) return;
    const index = document.getElementById('discountProductSelect').value;
    if (index === "") {
        alert("Select a product first");
        return;
    }
    const p = products[index];
    p.discount = 0;
    p.discountedPrice = null;
    localStorage.setItem('sapphire_products', JSON.stringify(products));
    renderProducts(currentCategory);
    renderAdminProductList();
    if (currentProduct && currentProduct.name === p.name) showProductDetail(p);
    alert("Discount removed!");
}

function getDisplayPrice(product) {
    if (product.discountedPrice !== null && product.discountedPrice !== undefined) {
        return `
            <div class="price-container">
                <span class="original-price">PKR ${product.originalPrice}</span>
                <span class="discounted-price">PKR ${product.discountedPrice}</span>
            </div>
        `;
    } else {
        return `<p class="price">PKR ${product.originalPrice}</p>`;
    }
}

// ==================== PRODUCTS ====================
function addProduct() {
    if (!isAdmin) return alert("Only admin can add products!");
    const name = document.getElementById('adminProdName').value.trim();
    const category = document.getElementById('adminProdCategory').value.trim().toLowerCase();
    const brand = document.getElementById('adminProdBrand').value.trim().toLowerCase();
    const originalPrice = parseInt(document.getElementById('adminProdPrice').value);
    const discountPerc = parseFloat(document.getElementById('adminProdDiscount').value) || 0;
    const stock = parseInt(document.getElementById('adminProdStock').value) || 0;
    const imgFile = document.getElementById('adminProdImgFile').files[0];
    if (!name || !category || !brand || !originalPrice || isNaN(originalPrice) || discountPerc < 0 || discountPerc >= 100 || stock < 0 || !imgFile) {
        return alert("Please fill all fields correctly. Discount must be 0-99.");
    }
    const reader = new FileReader();
    reader.onload = function(e) {
        const discountedPrice = discountPerc > 0 ? Math.round(originalPrice * (1 - discountPerc / 100)) : null;
        const newProduct = {
            name,
            category,
            brand,
            originalPrice,
            discount: discountPerc,
            discountedPrice,
            stock,
            img: e.target.result,
            rating: 0,
            ratingCount: 0
        };
        products.push(newProduct);
        localStorage.setItem('sapphire_products', JSON.stringify(products));
        renderProducts();
        addToSidePanel(brand, name);
        populateDiscountSelect();
        renderAdminProductList();
        renderAnalyticsDashboard();
        alert("Product added successfully!");
        clearAdminForm();
    };
    reader.readAsDataURL(imgFile);
}

function updateStock(productName, qty) {
    const p = products.find(p => p.name === productName);
    if (p) {
        p.stock -= qty;
        localStorage.setItem('sapphire_products', JSON.stringify(products));
        renderProducts();
        renderAdminProductList();
        renderAnalyticsDashboard();
    }
}
function deleteProduct(index) {
    if (!isAdmin || !confirm("Delete this product?")) return;
    const deleted = products.splice(index, 1)[0];
    localStorage.setItem('sapphire_products', JSON.stringify(products));
    renderProducts();
    renderAdminProductList();
    const li = document.querySelector(`#${deleted.brand} li[data-name="${deleted.name}"]`);
    if (li) li.remove();
    alert("Product deleted!");
}
function renderAdminProductList() {
    const container = document.getElementById('adminProductList');
    container.innerHTML = '';
    products.forEach((p, i) => {
        const div = document.createElement('div');
        div.className = 'product';
        div.innerHTML = `
            <img src="${p.img}" alt="${p.name}">
            <h3>${p.name}</h3>
            ${getDisplayPrice(p)}
            <p>Stock: ${p.stock} ${p.stock <= 5 ? '<span style="color:red;">(Low Stock!)</span>' : ''}</p>
            <button class="delete-btn" onclick="deleteProduct(${i})">Delete</button>
        `;
        container.appendChild(div);
    });
}
function addToSidePanel(brand, name) {
    const ul = document.getElementById(brand);
    if (!ul) return;
    if (!ul.querySelector(`li[data-name="${name}"]`)) {
        const li = document.createElement('li');
        li.textContent = name;
        li.dataset.name = name;
        li.onclick = () => {
            const product = products.find(p => p.name === name);
            if (product) showProductDetail(product);
        };
        ul.appendChild(li);
    }
}
function renderProducts(filter = 'all') {
    const container = document.getElementById('productContainer');
    container.innerHTML = '';
    products.forEach(p => {
        if (filter !== 'all' && p.category !== filter) return;
        const div = document.createElement('div');
        div.className = 'product';
        div.innerHTML = `
            <img src="${p.img}" alt="${p.name}">
            <h3>${p.name}</h3>
            ${getDisplayPrice(p)}
            <p class="stock">Stock: ${p.stock} ${p.stock <= 5 ? '<span style="color:red;">(Low)</span>' : ''}</p>
            <div class="rating" style="display:${p.rating > 0 ? 'block' : 'none'}">
                ${'‚òÖ'.repeat(Math.round(p.rating))} (${p.rating.toFixed(1)})
            </div>
            <div class="product-overlay">
                <button ${p.stock === 0 ? 'disabled' : ''} onclick="event.stopPropagation(); addToCart('${p.name.replace(/'/g,"\\'")}',${p.discountedPrice !== null ? p.discountedPrice : p.originalPrice})">
                    ${p.stock === 0 ? 'Out of Stock' : 'Add to Cart'}
                </button>
            </div>
        `;
        div.onclick = () => showProductDetail(p);
        container.appendChild(div);
    });
}
function filterCategory(category) {
    currentCategory = category;
    renderProducts(category);
}
function searchProducts() {
    const query = document.getElementById('searchBoxShop').value.toLowerCase().trim();
    const container = document.getElementById('productContainer');
    Array.from(container.children).forEach(prod => {
        const name = prod.querySelector('h3').textContent.toLowerCase();
        prod.style.display = name.includes(query) ? 'block' : 'none';
    });
}
function showProductDetail(product) {
    currentProduct = product;
    document.getElementById('detailImg').src = product.img;
    document.getElementById('detailName').textContent = product.name;
    document.getElementById('detailBrand').textContent = product.brand.charAt(0).toUpperCase() + product.brand.slice(1);
    document.getElementById('detailCategory').textContent = product.category.charAt(0).toUpperCase() + product.category.slice(1);
    document.getElementById('detailPriceContainer').innerHTML = getDisplayPrice(product);
    document.getElementById('detailStock').textContent = product.stock > 0 ? `${product.stock} in stock` : 'Out of stock';
    document.getElementById('detailAddToCart').disabled = product.stock === 0;
    document.getElementById('detailAddToCart').textContent = product.stock === 0 ? 'Out of Stock' : 'Add to Cart';
    const ratingDiv = document.getElementById('detailRating');
    if (product.rating > 0) {
        ratingDiv.innerHTML = `${'‚òÖ'.repeat(Math.round(product.rating))} (${product.rating.toFixed(1)} from ${product.ratingCount} reviews)`;
        ratingDiv.style.display = 'block';
    } else {
        ratingDiv.style.display = 'none';
    }
    document.getElementById('detailAddToCart').onclick = () => addToCart(product.name, product.discountedPrice !== null ? product.discountedPrice : product.originalPrice);
    showSection('productDetail');
}
function rateProduct(stars) {
    if (!currentUser) {
        alert("Please login to rate products!");
        showSection('login');
        return;
    }
    const idx = products.findIndex(p => p.name === currentProduct.name);
    if (idx === -1) return;
    const oldRating = products[idx].rating || 0;
    const oldCount = products[idx].ratingCount || 0;
    products[idx].rating = ((oldRating * oldCount) + stars) / (oldCount + 1);
    products[idx].ratingCount = oldCount + 1;
    localStorage.setItem('sapphire_products', JSON.stringify(products));
    showProductDetail(currentProduct);
    renderProducts(currentCategory);
    alert("Thank you for rating!");
}

// ==================== CART & CHECKOUT ====================
function getCart() {
    if (!currentUser) return [];
    const cart = localStorage.getItem('cart_' + currentUser);
    return cart ? JSON.parse(cart) : [];
}
function saveCart(cart) {
    if (!currentUser) return;
    localStorage.setItem('cart_' + currentUser, JSON.stringify(cart));
}
function addToCart(name, price) {
    const product = products.find(p => p.name === name);
    if (!product || product.stock === 0) {
        alert("This product is out of stock!");
        return;
    }
    if (!currentUser) {
        alert("Please login first!");
        showSection('login');
        return;
    }
    let cart = getCart();
    let item = cart.find(i => i.name === name);
    if (item) {
        if (item.qty + 1 > product.stock) {
            alert("Not enough stock!");
            return;
        }
        item.qty++;
    } else {
        cart.push({ name, price, qty: 1 });
    }
    saveCart(cart);
    renderCart();
    alert(`${name} added to cart!`);
}
function renderCart() {
    const container = document.getElementById('cartItems');
    const totalEl = document.getElementById('cartTotal');
    const cart = getCart();
    container.innerHTML = '';
    let total = 0;
    if (cart.length === 0) {
        container.innerHTML = "<p>Your cart is empty.</p>";
        totalEl.textContent = '';
    } else {
        cart.forEach((item, index) => {
            const div = document.createElement('div');
            div.className = 'cart-item';
            const itemTotal = item.price * item.qty;
            total += itemTotal;
            div.innerHTML = `
                <span>${item.name}</span>
                <input type="number" value="${item.qty}" min="1" onchange="updateQty(${index}, this.value)">
                <span>PKR ${itemTotal}</span>
                <button onclick="removeFromCart(${index})">Remove</button>
            `;
            container.appendChild(div);
        });
        totalEl.textContent = `Total: PKR ${total}`;
    }
    document.getElementById('cart-count').textContent = cart.reduce((sum, item) => sum + item.qty, 0);
}
function updateQty(index, value) {
    let cart = getCart();
    const product = products.find(p => p.name === cart[index].name);
    const newQty = Math.max(1, parseInt(value) || 1);
    if (newQty > product.stock) {
        alert("Not enough stock!");
        renderCart();
        return;
    }
    cart[index].qty = newQty;
    saveCart(cart);
    renderCart();
}
function removeFromCart(index) {
    let cart = getCart();
    cart.splice(index, 1);
    saveCart(cart);
    renderCart();
}
function clearCart() {
    if (confirm("Are you sure you want to clear the cart?")) {
        saveCart([]);
        renderCart();
    }
}
function startCheckout() {
    if (getCart().length === 0) {
        alert("Your cart is empty!");
        return;
    }
    document.getElementById('checkoutBtn').classList.add('hidden');
    document.getElementById('checkoutFormSection').classList.remove('hidden');
}
function cancelCheckout() {
    document.getElementById('checkoutFormSection').classList.add('hidden');
    document.getElementById('checkoutBtn').classList.remove('hidden');
}
function confirmOrder() {
    const name = document.getElementById('buyerName').value.trim();
    const phone = document.getElementById('buyerPhone').value.trim();
    const city = document.getElementById('buyerCity').value.trim();
    const address = document.getElementById('buyerAddress').value.trim();
    const landmark = document.getElementById('buyerLandmark').value.trim();
    if (!name || !phone || !city || !address) {
        alert("Please fill all required fields");
        return;
    }
    const cart = getCart();
    for (let item of cart) {
        const product = products.find(p => p.name === item.name);
        if (product.stock < item.qty) {
            alert(`Not enough stock for ${item.name}`);
            return;
        }
    }
    const total = cart.reduce((acc, i) => acc + i.price * i.qty, 0);
    const order = {
        id: Date.now(),
        date: new Date().toLocaleString(),
        buyer: { name, phone, city, address, landmark },
        items: cart,
        total,
        status: "Pending"
    };
    orders.push(order);
    localStorage.setItem('sapphire_orders', JSON.stringify(orders));
    cart.forEach(item => updateStock(item.name, item.qty));
    alert(`Order placed successfully!\nOrder ID: ${order.id}\nTotal: PKR ${total}\nWe will contact you soon.`);
    saveCart([]);
    renderCart();
    cancelCheckout();
    showSection('home');
}

// ==================== ADMIN ORDER MANAGEMENT ====================
function deleteOrder(orderId) {
    if (!confirm("Are you sure you want to permanently delete this order? This action cannot be undone.")) return;
    orders = orders.filter(o => o.id !== orderId);
    localStorage.setItem('sapphire_orders', JSON.stringify(orders));
    renderAdminOrderList();
    renderAnalyticsDashboard();
}
function updateOrderStatus(orderId, newStatus) {
    const order = orders.find(o => o.id == orderId);
    if (order) {
        order.status = newStatus;
        localStorage.setItem('sapphire_orders', JSON.stringify(orders));
        renderAdminOrderList();
    }
}
function renderAdminOrderList() {
    const container = document.getElementById('adminOrderList');
    container.innerHTML = orders.length === 0 ? '<p>No orders yet.</p>' : '';
    orders.reverse().forEach(order => {
        const itemsCount = order.items.reduce((sum, i) => sum + i.qty, 0);
        const div = document.createElement('div');
        div.className = 'order';
        div.innerHTML = `
            <div class="order-details">
                <strong>Order ID:</strong> ${order.id} | <strong>Date:</strong> ${order.date}<br>
                <strong>Buyer:</strong> ${order.buyer.name} (${order.buyer.phone})<br>
                <strong>Address:</strong> ${order.buyer.address}, ${order.buyer.city}<br>
                <strong>Items:</strong> ${itemsCount} | <strong>Total:</strong> PKR ${order.total}<br>
                <strong>Status:</strong>
                <select onchange="updateOrderStatus(${order.id}, this.value)">
                    <option value="Pending" ${order.status === 'Pending' ? 'selected' : ''}>Pending</option>
                    <option value="Confirmed" ${order.status === 'Confirmed' ? 'selected' : ''}>Confirmed</option>
                    <option value="Shipped" ${order.status === 'Shipped' ? 'selected' : ''}>Shipped</option>
                    <option value="Delivered" ${order.status === 'Delivered' ? 'selected' : ''}>Delivered</option>
                    <option value="Cancelled" ${order.status === 'Cancelled' ? 'selected' : ''}>Cancelled</option>
                </select>
                <button class="delete-order-btn" onclick="deleteOrder(${order.id})">Delete Order</button>
            </div>
        `;
        container.appendChild(div);
    });
}

// ==================== ANALYTICS DASHBOARD ====================
function renderAnalyticsDashboard() {
    const totalOrders = orders.length;
    const totalRevenue = orders.reduce((sum, o) => sum + o.total, 0);
    const lowStock = products.filter(p => p.stock <= 5).length;
    const totalProducts = products.length;
    document.getElementById('totalOrders').textContent = totalOrders;
    document.getElementById('totalRevenue').textContent = `PKR ${totalRevenue.toLocaleString()}`;
    document.getElementById('lowStock').textContent = lowStock;
    document.getElementById('totalProducts').textContent = totalProducts;
    const monthlyRevenue = {};
    orders.forEach(o => {
        const date = new Date(o.date);
        const monthKey = `${date.getFullYear()}-${String(date.getMonth()+1).padStart(2,'0')}`;
        monthlyRevenue[monthKey] = (monthlyRevenue[monthKey] || 0) + o.total;
    });
    const labels = Object.keys(monthlyRevenue).sort().slice(-6);
    const data = labels.map(k => monthlyRevenue[k] || 0);
    const ctx = document.getElementById('revenueChart').getContext('2d');
    if (revenueChart) revenueChart.destroy();
    revenueChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels.map(l => {
                const [y, m] = l.split('-');
                return new Date(y, m-1).toLocaleString('default', { month: 'short', year: 'numeric' });
            }),
            datasets: [{
                label: 'Monthly Revenue (PKR)',
                data: data,
                borderColor: '#800080',
                backgroundColor: 'rgba(128,0,128,0.2)',
                tension: 0.4,
                fill: true
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { position: 'top' }
            }
        }
    });
}

// ==================== WISHLIST ====================
function addToWishlist(product) {
    if (!currentUser) {
        alert("Please login first!");
        showSection('login');
        return;
    }
    if (wishlist.some(p => p.name === product.name)) {
        alert("Already in wishlist!");
        return;
    }
    wishlist.push(product);
    localStorage.setItem('wishlist_' + currentUser, JSON.stringify(wishlist));
    updateWishlistCount();
    alert(`${product.name} added to wishlist! ‚ù§Ô∏è`);
}
function updateWishlistCount() {
    const count = wishlist.length;
    document.getElementById('wishlist-count').textContent = count;
    document.getElementById('wishlistCount').textContent = count;
}
function renderWishlist() {
    const container = document.getElementById('wishlistItems');
    container.innerHTML = '';
    if (wishlist.length === 0) {
        container.innerHTML = "<p>Your wishlist is empty.</p>";
        return;
    }
    wishlist.forEach((item) => {
        const div = document.createElement('div');
        div.className = 'product';
        div.innerHTML = `
            <img src="${item.img}" alt="${item.name}">
            <h3>${item.name}</h3>
            ${getDisplayPrice(item)}
            <p class="stock">Stock: ${item.stock}</p>
            <div class="product-overlay">
                <button ${item.stock === 0 ? 'disabled' : ''} onclick="addToCart('${item.name.replace(/'/g,"\\'")}',${item.discountedPrice !== null ? item.discountedPrice : item.originalPrice})">
                    ${item.stock === 0 ? 'Out of Stock' : 'Add to Cart'}
                </button>
            </div>
        `;
        div.onclick = () => showProductDetail(item);
        container.appendChild(div);
    });
}

// ==================== INIT ====================
function init() {
    currentUser = localStorage.getItem('currentUser');
    isAdmin = localStorage.getItem('isAdmin') === 'true';
    products = JSON.parse(localStorage.getItem('sapphire_products') || '[]');
    orders = JSON.parse(localStorage.getItem('sapphire_orders') || '[]');
    if (currentUser) {
        wishlist = JSON.parse(localStorage.getItem('wishlist_' + currentUser) || '[]');
        updateHeader();
        if (isAdmin) {
            const loginForm = document.getElementById('adminLoginForm');
            const actions = document.getElementById('adminActions');
            if (loginForm && actions) {
                loginForm.classList.add('hidden');
                actions.classList.remove('hidden');
                populateDiscountSelect();
                renderAdminProductList();
                renderAdminOrderList();
                renderAnalyticsDashboard();
            }
        }
    }
    products.forEach(p => addToSidePanel(p.brand, p.name));
    updateWishlistCount();
    showSection('home');
    renderCart();
}

// Slideshow
const slides = ['images/Eveline.jpg','images/Neva.jpg','images/Gabrini.jpg'];
let slideIndex = 0;
function showSlide() {
    document.getElementById('slideShow').src = slides[slideIndex];
    slideIndex = (slideIndex + 1) % slides.length;
}
setInterval(showSlide, 4000);

function clearAdminForm() {
    document.getElementById('adminProdName').value = '';
    document.getElementById('adminProdCategory').value = '';
    document.getElementById('adminProdBrand').value = '';
    document.getElementById('adminProdPrice').value = '';
    document.getElementById('adminProdDiscount').value = '';
    document.getElementById('adminProdStock').value = '10';
    document.getElementById('adminProdImgFile').value = '';
}
</script>
</body>
</html>